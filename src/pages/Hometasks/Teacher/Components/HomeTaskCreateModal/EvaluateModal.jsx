import React, { useState, useRef, useEffect } from 'react';
import axios from 'axios';
import StandartInput from "../StandartInput/StandartInput";

const EvaluateModal = ({ isOpened, onClose, onNext, hometask = null, doneHometask = null, setRefreshTrigger }) => {
  const [AnswerDescription, setAnswerDescription] = useState("");
  const [Mark, setMark] = useState("");

  const handleEvaluate = async () => {
    if (Mark === "" || Mark < 0 || Mark > hometask.MaxMark) {
      alert("Пожалуйста, введите корректную оценку.");
      return;
    }

    try {
      await axios.put(`http://localhost:4000/api/doneHometasks/${doneHometask.DoneHometaskId}`, {
        Mark: parseInt(Mark)
      });
      onClose();
      setRefreshTrigger();
    } catch (error) {
      console.error('Ошибка при обновлении DoneHometask:', error);
      alert("Произошла ошибка при обновлении оценки.");
    }
  };

  if (!isOpened) return null;

  return (
    <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
      <style>
        {`
        input[type="date"]::-webkit-calendar-picker-indicator {
          display: none;
        }
        input[type="date"] {
          -webkit-appearance: none;
          -moz-appearance: textfield;
          appearance: none;
        }
      `}
      </style>
      <div
        className="
          w-full
          max-w-[600px]
          bg-white
          rounded-3xl
          outline outline-1 outline-[#8a48e6]
          flex flex-col
          px-2
        "
        onClick={(e) => e.stopPropagation()}
      >
        <div className="flex items-center justify-between px-4 py-2">
          <button className="w-10 h-10 bg-white rounded-full flex items-center justify-center" onClick={onClose}>
            <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 7H15M1 7L7 13M1 7L7 1" stroke="#120C38" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2 className="flex-1 text-center text-[#120c38] text-[15px] font-bold font-['Nunito'] mt-1">
            Оцінювання роботи вручну
          </h2>
          <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center"></div>
        </div>

        <div className="flex items-center justify-between px-4 py-2">

          <div className="w-full h-[119px] relative bg-[#120c38] rounded-3xl overflow-hidden">
            <div className='absolute bottom-0 left-4'>
              <svg width="103" height="108" viewBox="0 0 103 108" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M0.228085 129.953C0.286807 130.362 0.382091 130.764 0.512805 131.156C1.29635 133.703 3.22789 135.685 5.37581 136.804C6.05714 137.162 6.76266 137.473 7.48729 137.734C13.4095 139.988 20.6504 139.646 26.297 136.557C27.6034 135.838 28.7779 134.905 29.7706 133.796C31.7522 128.325 31.1122 122.247 30.8161 116.547C30.5177 110.746 30.0097 104.944 29.7364 99.1306C29.4517 93.1636 27.7024 68.7178 27.4063 62.7529C26.0707 63.0834 24.7159 63.3314 23.3496 63.4957C23.4453 66.691 24.9918 88.3763 25.0625 91.5761C25.1809 96.4947 25.4793 101.388 25.6091 106.296C25.7503 111.142 26.1307 116.282 24.6115 120.952C23.1537 125.386 19.9762 128.155 16.2977 128.688C15.015 128.881 13.7058 128.803 12.4551 128.461C11.0679 128.083 9.26622 127.363 8.6125 125.744C8.58313 125.691 8.55945 125.636 8.54189 125.578C8.11595 124.258 8.64895 122.736 9.37328 121.556C10.7126 119.364 12.3959 118.445 14.3524 117.254C15.7533 116.393 16.6302 113.705 14.1998 113.823C12.1704 113.916 9.89488 113.975 7.96107 114.894C4.60365 116.479 1.94779 120.696 0.774747 124.541C0.248585 126.274 -0.047523 128.16 0.228085 129.953Z" fill="#5224AA" />
                <path d="M79.389 129.953C79.3302 130.362 79.235 130.764 79.1042 131.156C78.323 133.703 76.3892 135.685 74.2412 136.804C73.5607 137.162 72.8559 137.473 72.132 137.734C66.2099 139.988 58.9666 139.646 53.3201 136.557C52.0144 135.837 50.8402 134.904 49.8465 133.796C47.8648 128.325 48.5049 122.247 48.8033 116.547C49.0994 110.746 49.6096 104.944 49.8829 99.1306C50.1654 93.1636 51.9147 68.7178 52.2131 62.7529C53.5478 63.0834 54.9019 63.3314 56.2675 63.4957C56.1741 66.691 54.6252 88.3763 54.5546 91.5761C54.4362 96.4947 54.14 101.388 54.0079 106.296C53.8667 111.142 53.4863 116.282 55.0056 120.952C56.4634 125.386 59.6431 128.155 63.3194 128.688C64.6021 128.881 65.9112 128.804 67.162 128.461C68.5491 128.083 70.3645 127.363 71.0045 125.744C71.0358 125.692 71.0596 125.636 71.0752 125.578C71.5034 124.258 70.9681 122.736 70.2461 121.556C68.9045 119.364 67.2212 118.445 65.2646 117.254C63.8638 116.393 62.9868 113.705 65.4172 113.823C67.4467 113.916 69.7244 113.975 71.656 114.894C75.0134 116.479 77.6693 120.696 78.8446 124.541C79.3776 126.274 79.6737 128.16 79.389 129.953Z" fill="#5224AA" />
                <path d="M73.879 1.06632C59.2444 -2.31691 38.2663 2.41147 31.1028 14.3841C13.4388 16.0961 0 28.8387 0 41.3209C0 55.0011 16.147 67.164 36.2778 67.164C36.5056 67.164 36.7334 67.1436 36.9611 67.1413C49.6665 67.1413 53.7277 71.2854 65.2372 72.3951C79.5119 73.7719 92.3858 73.2375 99.957 51.9824C107.793 29.9642 93.7205 5.66109 73.879 1.06632Z" fill="#8A48E6" />
                <path d="M37.7567 146.338C36.9696 148.239 35.8229 149.971 34.3788 151.442C34.2056 151.646 34.0183 151.837 33.8184 152.015C33.1514 152.644 32.4321 153.215 31.6682 153.723C31.3243 153.949 30.9621 154.176 30.6023 154.389C29.945 154.747 29.2691 155.07 28.5773 155.358C28.3496 155.448 28.1628 155.537 27.9441 155.609C27.4027 155.824 26.8481 156.004 26.2836 156.148C23.6813 156.872 20.9716 157.137 18.2773 156.932C18.1862 156.932 18.1156 156.913 18.0245 156.913C16.372 156.793 14.7333 156.529 13.1273 156.123C8.5718 155.009 4.38073 152.692 1.97769 148.471C-4.36586 137.375 6.5127 116.994 20.464 121.091C20.6108 121.13 20.7553 121.178 20.8967 121.233C20.915 121.233 20.9332 121.251 20.9514 121.251C21.3102 121.38 21.6258 121.606 21.8625 121.904C21.8853 121.935 21.924 121.956 21.9445 121.987C21.965 122.019 21.9445 121.987 21.9445 122.001C21.9832 122.062 22.047 122.098 22.0766 122.169C22.5322 123.138 21.678 124.179 20.8307 124.845C18.2636 126.856 15.0475 128.133 12.9337 130.629C10.3667 133.629 9.91567 138.328 12.0659 141.625C15.8424 147.409 23.8646 146.046 26.7938 140.332C29.6296 134.78 28.7277 127.877 28.9623 121.881C29.1422 117.209 28.9623 112.519 28.7983 107.868C28.4908 98.47 27.8872 89.0925 27.1537 79.715C26.721 74.108 26.2274 68.5025 25.6732 62.8985L39.8226 58.46V126.342C39.8181 132.9 40.3966 140.086 37.7567 146.338Z" fill="#8A48E6" />
                <path d="M39.8147 58.4482V126.344C39.8147 132.898 39.2316 140.094 41.8647 146.344C45.1538 154.159 53.1715 157.5 61.3486 156.92C67.6876 156.467 74.3318 154.248 77.6437 148.466C84.0009 137.37 73.1246 116.989 59.1551 121.079C58.5174 121.265 57.834 121.554 57.5607 122.155C57.1052 123.121 57.9616 124.179 58.8044 124.838C61.3851 126.856 64.5899 128.128 66.715 130.617C69.2798 133.62 69.7308 138.317 67.5737 141.614C63.8018 147.393 55.7795 146.041 52.848 140.328C50.0031 134.779 50.921 127.873 50.6864 121.862C50.5042 117.204 50.6864 112.514 50.839 107.858C51.1534 98.4651 51.7501 89.0808 52.479 79.7124C52.9186 74.0985 53.3901 68.4847 53.9732 62.8845L39.8147 58.4482Z" fill="#8A48E6" />
                <path d="M53.3008 69.8677C56.7561 70.8913 60.314 71.9216 65.2339 72.3949C79.5086 73.7718 92.3825 73.2373 99.9538 51.9823C103.241 42.7542 102.669 33.1276 99.4458 24.7148C102.197 33.2613 90.9566 45.56 82.8638 46.5994C81.5435 46.7544 80.3016 47.3041 79.3023 48.1759C78.303 49.0476 77.5934 50.2004 77.2673 51.4818C73.2311 67.9609 53.3008 69.8677 53.3008 69.8677Z" fill="#5224AA" />
                <path d="M44.2686 23.8856C44.2686 23.8177 43.8381 20.1786 42.7129 18.1722C46.5372 17.8099 61.0101 22.7488 63.9848 26.003C55.7212 23.7951 44.3961 23.8856 44.2732 23.8856H44.2686Z" fill="#120C38" />
                <path d="M25.5099 22.0908C25.5099 22.0908 25.1045 18.4018 25.7628 16.1758C21.9521 16.6604 8.92786 24.6475 6.74805 28.4745C14.3694 24.4867 25.5099 22.0908 25.5099 22.0908Z" fill="#120C38" />
                <path d="M49.9886 46.3245C53.2593 46.3245 55.9107 43.6884 55.9107 40.4367C55.9107 37.1849 53.2593 34.5488 49.9886 34.5488C46.7178 34.5488 44.0664 37.1849 44.0664 40.4367C44.0664 43.6884 46.7178 46.3245 49.9886 46.3245Z" fill="white" />
                <path d="M50.8379 44.511C52.6921 44.511 54.1953 42.5553 54.1953 40.1427C54.1953 37.7302 52.6921 35.7744 50.8379 35.7744C48.9836 35.7744 47.4805 37.7302 47.4805 40.1427C47.4805 42.5553 48.9836 44.511 50.8379 44.511Z" fill="#120C38" />
                <path d="M39.8622 68.6157C39.8622 68.6157 39.4863 91.3994 39.4863 104.09C39.4863 116.78 39.6982 135.164 39.6982 135.164C39.6982 135.164 40.0262 112.729 40.0262 103.936C40.0262 95.1427 39.8804 68.2783 39.8804 68.2783" fill="#120C38" />
                <path d="M49.987 26.9769C46.6543 26.9784 43.4448 28.2298 40.9996 30.4812C38.5544 32.7326 37.0534 35.8181 36.7965 39.1217H33.1863C32.9213 35.7283 31.3448 32.5688 28.7876 30.3059C26.2304 28.0431 22.8911 26.8527 19.4702 26.9845C16.0494 27.1163 12.8128 28.5601 10.4394 31.0129C8.06598 33.4658 6.74023 36.7371 6.74023 40.1407C6.74023 43.5443 8.06598 46.8156 10.4394 49.2685C12.8128 51.7213 16.0494 53.1651 19.4702 53.2969C22.8911 53.4287 26.2304 52.2383 28.7876 49.9755C31.3448 47.7126 32.9213 44.5531 33.1863 41.1597H36.7965C36.9972 43.7111 37.9418 46.149 39.5147 48.1748C41.0875 50.2006 43.2205 51.7265 45.6522 52.5657C48.084 53.4048 50.7092 53.5208 53.2062 52.8994C55.7033 52.2779 57.9639 50.9461 59.7113 49.067C61.4587 47.1878 62.617 44.8428 63.0445 42.3192C63.472 39.7956 63.15 37.2028 62.118 34.8583C61.0861 32.5138 59.3889 30.5193 57.2342 29.1191C55.0796 27.7188 52.5611 26.9736 49.987 26.9746V26.9769ZM19.998 51.357C17.7665 51.3575 15.585 50.7 13.7294 49.4677C11.8738 48.2354 10.4274 46.4837 9.57325 44.434C8.71908 42.3844 8.49547 40.129 8.93071 37.9531C9.36594 35.7771 10.4405 33.7783 12.0184 32.2096C13.5963 30.6408 15.6067 29.5725 17.7954 29.1398C19.984 28.7071 22.2526 28.9294 24.3141 29.7786C26.3757 30.6278 28.1376 32.0658 29.3771 33.9107C30.6166 35.7555 31.2779 37.9244 31.2775 40.143C31.2775 41.6156 30.9857 43.0738 30.4189 44.4344C29.8521 45.7949 29.0212 47.0312 27.9738 48.0725C26.9264 49.1138 25.683 49.9398 24.3145 50.5034C22.946 51.0669 21.4793 51.357 19.998 51.357ZM49.987 51.357C47.7557 51.3566 45.5746 50.6983 43.7196 49.4655C41.8646 48.2326 40.4189 46.4806 39.5654 44.4309C38.712 42.3812 38.489 40.126 38.9248 37.9503C39.3605 35.7746 40.4354 33.7763 42.0135 32.208C43.5916 30.6397 45.602 29.5718 47.7905 29.1395C49.9791 28.7071 52.2474 28.9297 54.3087 29.7791C56.37 30.6284 58.1317 32.0664 59.3709 33.9111C60.6102 35.7559 61.2714 37.9246 61.271 40.143C61.271 41.616 60.9791 43.0746 60.4119 44.4354C59.8448 45.7963 59.0136 47.0327 57.9657 48.0741C56.9178 49.1155 55.6738 49.9414 54.3048 50.5047C52.9358 51.068 51.4686 51.3576 49.987 51.357Z" fill="#120C38" />
                <path d="M12.8926 41.5521C12.9198 41.7715 13.0267 41.9735 13.1933 42.1199C13.3598 42.2663 13.5745 42.3472 13.7968 42.3472C14.0192 42.3472 14.2339 42.2663 14.4004 42.1199C14.567 41.9735 14.6739 41.7715 14.7011 41.5521C14.7011 41.5227 14.6875 41.5 14.6852 41.4728H14.7102C14.7102 40.1155 15.2526 38.8137 16.218 37.854C17.1833 36.8942 18.4927 36.355 19.858 36.355C21.2232 36.355 22.5326 36.8942 23.4979 37.854C24.4633 38.8137 25.0057 40.1155 25.0057 41.4728H25.0307C25.0307 41.5 25.0148 41.5227 25.0148 41.5521C25.042 41.7715 25.1489 41.9735 25.3155 42.1199C25.482 42.2663 25.6967 42.3472 25.9191 42.3472C26.1414 42.3472 26.3561 42.2663 26.5226 42.1199C26.6892 41.9735 26.7962 41.7715 26.8233 41.5521C26.8233 41.5227 26.8097 41.5 26.8074 41.4728H26.8233C26.8233 39.6362 26.0895 37.8748 24.7832 36.5761C23.477 35.2774 21.7053 34.5479 19.858 34.5479C18.0106 34.5479 16.239 35.2774 14.9327 36.5761C13.6264 37.8748 12.8926 39.6362 12.8926 41.4728H12.9085C12.9062 41.5 12.8926 41.5227 12.8926 41.5521Z" fill="#120C38" />
              </svg>
            </div>

            <div className="w-[372px] left-[149px] top-[15px] absolute justify-start text-white text-[15px] font-normal font-['Mulish']">Перевіряйте роботу швидше, з нашею  AI перевіркою</div>
            <div data-property-1="Active" className="w-[143px] h-10 px-4 py-2 left-[378px] top-[64px] absolute bg-[#8a48e6]  hover:bg-purple-700 cursor-pointer rounded-[40px] inline-flex justify-center items-center gap-2.5">
              <div className="justify-start text-white text-[15px] font-bold font-['Nunito']" onClick={onNext}>Перейти</div>
            </div>
          </div>
        </div>

        <div className="w-[536px] h-0 outline outline-1 outline-offset-[-0.50px] outline-[#827ead] mx-auto my-3" />

        <div className='px-4 py-2'>
          <StandartInput placeholder="Додатковий коментар (Не обов'язково)" />
        </div>

        <div className='flex justify-between px-4 py-2 mb-2'>

          <div className="flex h-12 items-center justify-center text-[#8a48e6] text-2xl font-bold font-['Nunito']">
            <div className="w-12 h-12 relative rounded-2xl border border-[#8a48e6] flex items-center justify-center mr-1">
              <input
                type="number"
                value={Mark}
                min={0}
                max={hometask.MaxMark}
                onChange={(e) => {setMark(e.target.value)}}
                className="w-full h-full text-center text-[#120c38] text-2xl font-bold font-['Mulish'] bg-transparent border-none focus:outline-none no-arrows"
              />
            </div>
            <span>/{hometask.MaxMark}</span>
          </div>

          <div className="h-10 px-4 py-2.5 bg-white hover:bg-[#8a48e6] text-[#8a48e6] hover:text-white stroke-[#8A48E6] hover:stroke-white cursor-pointer rounded-[40px] outline outline-1 outline-offset-[-1px] outline-[#8a48e6] inline-flex justify-end items-center gap-2.5" style={{display: ((Mark === "" || Mark<0 || Mark>hometask.MaxMark) && "none")}} onClick={handleEvaluate}>
            <div className="justify-center text-[15px] font-bold font-['Nunito']">Оцінити роботу </div>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 12L4.69799 4.034C4.605 3.99783 4.50331 3.99031 4.40601 4.01241C4.30871 4.03451 4.22024 4.08521 4.15199 4.158C4.08199 4.23267 4.0338 4.3251 4.01264 4.42524C3.99149 4.52538 3.99818 4.6294 4.03199 4.726L6.49999 12M21 12L4.69799 19.966C4.605 20.0022 4.50331 20.0097 4.40601 19.9876C4.30871 19.9655 4.22024 19.9148 4.15199 19.842C4.08199 19.7673 4.0338 19.6749 4.01264 19.5748C3.99149 19.4746 3.99818 19.3706 4.03199 19.274L6.49999 12M21 12H6.49999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </div>

      </div>
    </div>
  );
};

export default EvaluateModal;